# 1.2.5 设计示意图 - 测试历史

## 功能描述

查看所有测试执行的历史记录，支持筛选、搜索、查看详细结果、对比执行结果、导出数据。帮助用户追踪测试执行趋势和问题。

## 页面结构

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║  测试历史                                          [导出] [刷新]              ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  筛选: 状态 [▼全部] 日期范围 [______ - ______] 搜索 [_______] [应用]        ║
║                                                                               ║
║  ┌───────────────────────────────────────────────────────────────────────┐   ║
║  │ ID    │ 测试用例      │ 执行时间          │ 状态    │ 耗时  │ 操作    │   ║
║  ├───────────────────────────────────────────────────────────────────────┤   ║
║  │ RUN-1 │ 用户登录测试  │ 2024-11-22 09:30  │ ✓ PASS  │ 2.5s  │ [查看]  │   ║
║  │ RUN-2 │ 产品创建测试  │ 2024-11-22 09:25  │ ✗ FAIL  │ 3.1s  │ [查看]  │   ║
║  │ RUN-3 │ 数据查询测试  │ 2024-11-22 09:20  │ ⚠ BLOCK │ 0.8s  │ [查看]  │   ║
║  │ RUN-4 │ API集成测试   │ 2024-11-21 15:45  │ ✓ PASS  │ 5.2s  │ [查看]  │   ║
║  │ RUN-5 │ 性能压测      │ 2024-11-21 14:30  │ ✓ PASS  │ 60s   │ [查看]  │   ║
║  └───────────────────────────────────────────────────────────────────────┘   ║
║                                                                               ║
║  共 150 条记录  第 1/15 页  [<] [1] [2] [3] ... [15] [>]                    ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 交互流程

- 页面加载 → 获取最近的测试执行记录
- 应用筛选 → 按状态/日期范围/关键词过滤列表
- 点击"查看" → 打开详情对话框，显示完整执行日志
- 点击"导出" → 选择格式（CSV/Excel/JSON）→ 下载文件
- 点击"刷新" → 重新获取最新数据
- 分页导航 → 加载对应页数据

## 数据字段

| 字段名 | 类型 | 校验规则 | 说明 |
|--------|------|----------|------|
| id | string | 唯一 | 执行记录ID |
| testCaseId | string | 必填 | 关联的测试用例ID |
| testCaseTitle | string | - | 测试用例标题 |
| executedAt | datetime | - | 执行时间 |
| status | enum | PASSED/FAILED/BLOCKED/SKIPPED | 执行状态 |
| duration | number | ≥0 | 执行耗时（秒） |
| executedBy | string | - | 执行人 |
| logs | array | - | 执行日志数组 |

## 权限说明

- 访问权限：已登录用户
- 权限要求：VIEW_HISTORY 权限
- 数据范围：当前项目的测试历史

## 后端 API 依赖

- `GET /api/runs` - 获取测试执行记录列表（支持分页和筛选）
- `GET /api/runs/:id` - 获取单个执行记录详情

## 实现建议

- 使用服务端分页减少数据传输
- 日期范围选择使用日期选择器组件
- 状态使用图标+颜色区分（绿色✓、红色✗、黄色⚠）
- 导出功能使用 exceljs 或类似库
- 详情对话框显示完整日志，支持搜索和高亮
- 实现表格排序功能

## 测试要点

- [ ] 列表正确显示历史记录
- [ ] 筛选功能正常工作
- [ ] 分页导航正确
- [ ] 查看详情显示完整信息
- [ ] 导出功能生成正确格式文件
- [ ] 状态图标和颜色正确
- [ ] 多租户数据隔离

### 子功能 1: 执行详情对话框

```
       ╔═══════════════════════════════════════╗
       ║  执行详情: RUN-12345            [×]   ║
       ╠═══════════════════════════════════════╣
       ║  测试用例: TC-001 用户登录测试        ║
       ║  执行时间: 2024-11-22 15:30:25        ║
       ║  执行人: admin                        ║
       ║  状态: ✓ PASSED                       ║
       ║  耗时: 3.5s                           ║
       ║                                       ║
       ║  步骤执行明细:                        ║
       ║  ✓ 步骤1: 访问登录页 (0.8s)          ║
       ║  ✓ 步骤2: 提交登录 (1.2s)            ║
       ║  ✓ 步骤3: 验证状态 (1.5s)            ║
       ║                                       ║
       ║  [查看完整日志]  [重新运行]  [关闭]   ║
       ╚═══════════════════════════════════════╝
```

### 子功能 2: 日志查看对话框

```
       ╔═══════════════════════════════════════╗
       ║  执行日志: RUN-12345      [导出] [×] ║
       ╠═══════════════════════════════════════╣
       ║  [09:30:15] 开始执行测试用例...       ║
       ║  [09:30:16] Step 1: GET /login        ║
       ║  [09:30:16] Response: 200 OK          ║
       ║  [09:30:17] Assertion passed ✓        ║
       ║  [09:30:18] Step 2: POST /auth/login  ║
       ║  [09:30:19] Request body: {...}       ║
       ║  [09:30:19] Response: 200 OK          ║
       ║  [09:30:20] Token saved: eyJ...       ║
       ║  [09:30:21] Assertion passed ✓        ║
       ║  [09:30:22] All steps completed ✓     ║
       ║                                       ║
       ║  [搜索日志______]  [高亮错误]         ║
       ╚═══════════════════════════════════════╝
```

---

*此线框图由 ui-wireframe-generator skill 自动生成*
