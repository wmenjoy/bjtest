# 1.2.11 设计示意图 - 系统配置

## 功能描述

系统级配置页面，管理全局设置、API 密钥、环境变量、集成配置、通知设置等。

## 页面结构

```
╔═══════════════════════════════════════════════════════════════════╗
║  系统配置                      [通用] [集成] [环境] [通知]        ║
╠═══════════════════════════════════════════════════════════════════╣
║                                                                   ║
║  通用设置                                                         ║
║                                                                   ║
║  系统名称: [NextTest Platform___________________________]         ║
║                                                                   ║
║  语言: [▼ 中文]                                                   ║
║                                                                   ║
║  时区: [▼ Asia/Shanghai (UTC+8)]                                 ║
║                                                                   ║
║  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      ║
║                                                                   ║
║  AI 集成                                                          ║
║                                                                   ║
║  Gemini API Key:                                                  ║
║  [****************************************___]  [测试连接]        ║
║                                                                   ║
║  模型: [▼ gemini-1.5-pro]                                        ║
║                                                                   ║
║  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━      ║
║                                                                   ║
║  环境变量                                                         ║
║                                                                   ║
║  ┌──────────────────────────────────────────────────────────┐    ║
║  │ KEY             │ VALUE                    │ 密钥? │ 操作 │    ║
║  ├──────────────────────────────────────────────────────────┤    ║
║  │ API_BASE_URL    │ http://localhost:8090    │  [ ]  │ [×]  │    ║
║  │ DATABASE_URL    │ sqlite:./data/db.sqlite  │  [ ]  │ [×]  │    ║
║  │ SECRET_KEY      │ ********                 │  [✓]  │ [×]  │    ║
║  └──────────────────────────────────────────────────────────┘    ║
║                                                                   ║
║  [+添加变量]                                                      ║
║                                                                   ║
║  [保存配置]                                                       ║
╚═══════════════════════════════════════════════════════════════════╝
```

## 交互流程

- 切换标签 → 显示不同配置分类
- 修改配置项 → 点击"保存" → 更新配置
- 点击"测试连接" → 验证 API 密钥有效性
- 添加环境变量 → 输入 KEY/VALUE → 勾选是否密钥
- 删除变量 → 点击"×" → 确认删除

## 数据字段

| 字段名 | 类型 | 校验规则 | 说明 |
|--------|------|----------|------|
| systemName | string | 必填 | 系统名称 |
| language | enum | zh-CN/en-US | 语言 |
| timezone | string | 有效时区 | 时区 |
| geminiApiKey | string | 可选 | Gemini API 密钥 |
| geminiModel | string | 可选 | 模型名称 |
| envVariables | array | - | 环境变量列表 |

## 权限说明

- 访问权限：管理员
- 权限要求：MANAGE_CONFIG 权限

## 后端 API 依赖

- `GET /api/config` - 获取系统配置
- `PUT /api/config` - 更新系统配置
- `POST /api/config/test-gemini` - 测试 Gemini API 连接

## 实现建议

- 密钥字段使用密码输入框
- API 密钥保存前加密
- 配置更改需要确认
- 实现配置版本控制和回滚
- 添加配置导入导出功能

## 测试要点

- [ ] 配置加载正确
- [ ] 保存配置成功
- [ ] 密钥字段脱敏显示
- [ ] 测试连接功能正常
- [ ] 环境变量增删改正常
- [ ] 配置更改立即生效

### 子功能 1: 环境变量编辑对话框

```
       ╔═══════════════════════════════════════╗
       ║  添加/编辑环境变量              [×]   ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  变量名:                              ║
       ║  [DATABASE_URL_______________]        ║
       ║  validation: 必填，大写字母和下划线    ║
       ║                                       ║
       ║  变量值:                              ║
       ║  [sqlite:./data/db.sqlite_______]     ║
       ║  validation: 必填                      ║
       ║                                       ║
       ║  描述（可选）:                        ║
       ║  [数据库连接字符串_______________]    ║
       ║                                       ║
       ║  [ ] 标记为敏感信息（密钥）            ║
       ║      勾选后将加密存储并脱敏显示       ║
       ║                                       ║
       ║  [   保存   ]      [   取消   ]       ║
       ╚═══════════════════════════════════════╝
```

**说明**: 添加或编辑全局环境变量，支持敏感信息加密存储。

---

*此线框图由 ui-wireframe-generator skill 自动生成*
