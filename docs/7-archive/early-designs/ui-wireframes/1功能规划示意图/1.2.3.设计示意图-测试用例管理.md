# 1.2.3 设计示意图 - 测试用例管理

## 功能描述

测试用例的完整生命周期管理页面。支持文件夹树形结构组织、用例创建/编辑、AI 自动生成、标签分类、优先级管理、状态跟踪。用户可以快速创建和管理测试用例，支持手动和自动化测试类型。

## 页面结构

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║  测试用例管理                                                                 ║
╠═══════════════╦═══════════════════════════════╦═══════════════════════════════╣
║               ║                               ║                               ║
║  文件夹树      ║    用例列表                    ║    用例详情/编辑              ║
║               ║                               ║                               ║
║  📁 Root      ║  [+新建] [🤖AI生成] [搜索___] ║  [编辑] [运行] [删除]         ║
║   ├─ 项目A    ║                               ║                               ║
║   │  ├─ 模块1 ║  ┌─────────────────────────┐ ║  标题: [___________________] ║
║   │  │  └─ M1║  │ TC-001 [P1] [DRAFT]     │ ║                               ║
║   │  └─ 模块2 ║  │ 用户登录测试              │ ║  描述: [___________________] ║
║   └─ 项目B    ║  │ Tags: login, auth        │ ║       [___________________] ║
║               ║  │ 2024-11-22               │ ║                               ║
║  [新建项目]   ║  └─────────────────────────┘ ║  优先级: [▼ High]            ║
║  [新建模块]   ║                               ║  状态: [▼ Draft]              ║
║               ║  ┌─────────────────────────┐ ║                               ║
║               ║  │ TC-002 [P2] [ACTIVE]    │ ║  自动化类型:                  ║
║               ║  │ 产品创建测试              │ ║  ( ) 手动                     ║
║               ║  │ Tags: product            │ ║  (●) HTTP API                 ║
║               ║  │ 2024-11-21               │ ║  ( ) Workflow                 ║
║               ║  └─────────────────────────┘ ║                               ║
║               ║                               ║  测试步骤:                    ║
║               ║  ┌─────────────────────────┐ ║  1. [步骤描述_____________] ║
║               ║  │ TC-003 [P3] [ACTIVE]    │ ║     Expected: [___________] ║
║               ║  │ 数据查询测试              │ ║  2. [步骤描述_____________] ║
║               ║  │ Tags: database           │ ║     Expected: [___________] ║
║               ║  │ 2024-11-20               │ ║  [+添加步骤]                  ║
║               ║  └─────────────────────────┘ ║                               ║
║               ║                               ║  标签: [tag1] [tag2] [+]      ║
║               ║  第1页 / 共5页  [<] [>]      ║                               ║
║               ║                               ║  [保存] [取消]                ║
╚═══════════════╩═══════════════════════════════╩═══════════════════════════════╝

### 子功能 1: AI 生成对话框

       ╔═══════════════════════════════════════════╗
       ║  AI 生成测试用例                    [×]   ║
       ╠═══════════════════════════════════════════╣
       ║                                           ║
       ║  描述你想测试的功能:                      ║
       ║  ┌─────────────────────────────────────┐ ║
       ║  │                                     │ ║
       ║  │                                     │ ║
       ║  │                                     │ ║
       ║  └─────────────────────────────────────┘ ║
       ║                                           ║
       ║  示例: "测试用户登录功能，包括正常登录、  ║
       ║        错误密码、账号不存在等场景"        ║
       ║                                           ║
       ║     [生成中...] / [生成测试用例]          ║
       ╚═══════════════════════════════════════════╝
```

## 交互流程

- 点击左侧文件夹 → 右侧显示该文件夹下的用例列表
- 点击用例列表项 → 右侧显示用例详情
- 点击"编辑" → 进入编辑模式
- 点击"新建" → 创建新用例，打开编辑器
- 点击"AI生成" → 打开 AI 生成对话框
- 输入描述并提交 → 调用 Gemini API 生成用例 → 显示生成的用例
- 点击"运行" → 跳转到 [1.2.4 测试执行器]
- 点击"新建项目/模块" → 在文件夹树中添加节点
- 搜索 → 实时过滤用例列表

## 数据字段

| 字段名 | 类型 | 校验规则 | 说明 |
|--------|------|----------|------|
| id | string | 必填，唯一 | 测试用例ID，如 TC-001 |
| title | string | 必填，1-100字符 | 用例标题 |
| description | string | 可选，最多500字符 | 用例描述 |
| priority | enum | HIGH/MEDIUM/LOW | 优先级 |
| status | enum | DRAFT/ACTIVE/DEPRECATED | 状态 |
| automationType | enum | MANUAL/HTTP/WORKFLOW | 自动化类型 |
| steps | array | 至少1个步骤 | 测试步骤列表 |
| tags | array | 可选 | 标签数组 |
| folderId | string | 必填 | 所属文件夹ID |
| projectId | string | 必填 | 所属项目ID |
| lastUpdated | datetime | 自动 | 最后更新时间 |

## 权限说明

- 访问权限：已登录用户
- 权限要求：VIEW_CASES 权限（查看）、EDIT_CASES 权限（编辑）
- 数据范围：仅显示当前项目的用例
- 文件夹操作：需要 MANAGE_FOLDERS 权限
- AI 生成：需要配置 Gemini API Key

## 后端 API 依赖

- `GET /api/cases` - 获取测试用例列表
- `POST /api/cases` - 创建新测试用例
- `PUT /api/cases/:id` - 更新测试用例
- `DELETE /api/cases/:id` - 删除测试用例
- `GET /api/folders` - 获取文件夹树
- `POST /api/folders` - 创建文件夹
- `POST /api/gemini/generate` - AI 生成测试用例（前端调用）

## 实现建议

- 使用虚拟滚动优化大量用例的渲染性能
- 文件夹树使用递归组件实现
- 用例列表支持分页或无限滚动
- 实现拖拽排序和移动用例到不同文件夹
- AI 生成使用 streaming response 提升用户体验
- 表单验证使用 React Hook Form + Zod
- 状态管理使用自定义 hooks（如代码中的 useAppState）
- 实现撤销/重做功能（可选）
- 支持批量操作（批量删除、批量修改标签）

## 测试要点

- [ ] 文件夹树正确展示层级结构
- [ ] 点击文件夹正确过滤用例列表
- [ ] 新建用例保存成功
- [ ] 编辑用例数据回显正确
- [ ] 删除用例提示确认
- [ ] AI 生成功能正常工作
- [ ] AI 生成失败时显示错误提示
- [ ] 搜索功能实时过滤
- [ ] 分页功能正常
- [ ] 表单验证规则生效
- [ ] 多租户数据隔离
- [ ] 权限控制正确（无权限时禁用按钮）
- [ ] 拖拽移动用例功能正常

### 子功能 2: 文件夹管理对话框

```
       ╔═══════════════════════════════════════╗
       ║  新建文件夹                      [×]  ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  文件夹名称:                          ║
       ║  [_______________________________]    ║
       ║  validation: 必填，1-50字符            ║
       ║                                       ║
       ║  父文件夹:                            ║
       ║  [▼ Root / 项目A / 模块1]             ║
       ║                                       ║
       ║  类型:                                ║
       ║  (•) 项目   ( ) 模块                  ║
       ║                                       ║
       ║  描述（可选）:                        ║
       ║  [_______________________________]    ║
       ║                                       ║
       ║  [   创建   ]      [   取消   ]       ║
       ╚═══════════════════════════════════════╝
```

**说明**: 用于创建新的项目或模块文件夹，组织测试用例的层级结构。

### 子功能 3: 用例详情查看模式

当用户点击用例列表中的某个用例时，右侧面板显示只读的详情视图：

```
╔══════════════════════════════════════════════╗
║  TC-001: 用户登录测试              [编辑]   ║
╠══════════════════════════════════════════════╣
║                                              ║
║  优先级: High      状态: Active              ║
║  创建时间: 2024-11-22 10:30                  ║
║  最后更新: 2024-11-22 15:45                  ║
║  创建人: admin                               ║
║                                              ║
║  描述:                                       ║
║  测试用户通过用户名和密码登录系统的功能，    ║
║  包括正常登录、错误密码、账号锁定等场景。    ║
║                                              ║
║  自动化类型: HTTP API                        ║
║                                              ║
║  测试步骤:                                   ║
║  1. 访问登录页面                             ║
║     期望: 显示登录表单                       ║
║  2. 输入有效的用户名和密码                   ║
║     期望: 无错误提示                         ║
║  3. 点击登录按钮                             ║
║     期望: 跳转到首页，显示用户信息           ║
║                                              ║
║  标签: [login] [auth] [critical]             ║
║                                              ║
║  关联工作流: workflow-auth-001               ║
║                                              ║
║  [运行测试]  [复制]  [删除]                  ║
╚══════════════════════════════════════════════╝
```

### 子功能 4: 批量操作对话框

用户可以选择多个用例进行批量操作：

```
       ╔═══════════════════════════════════════╗
       ║  批量操作 (已选择 5 个用例)      [×]  ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  操作类型:                            ║
       ║  [▼ 选择操作]                         ║
       ║      - 修改优先级                     ║
       ║      - 修改状态                       ║
       ║      - 添加标签                       ║
       ║      - 移动到文件夹                   ║
       ║      - 删除                           ║
       ║                                       ║
       ║  目标值:                              ║
       ║  [▼ 根据操作类型显示]                 ║
       ║                                       ║
       ║  已选择用例:                          ║
       ║  - TC-001: 用户登录测试               ║
       ║  - TC-003: 数据查询测试               ║
       ║  - TC-005: 文件上传测试               ║
       ║  - TC-008: 权限验证测试               ║
       ║  - TC-012: 性能基准测试               ║
       ║                                       ║
       ║  [   执行   ]      [   取消   ]       ║
       ╚═══════════════════════════════════════╝
```

**说明**: 支持批量修改多个测试用例的属性，提高操作效率。

### 子功能 5: 用例导入对话框

```
       ╔═══════════════════════════════════════╗
       ║  导入测试用例                    [×]  ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  导入格式:                            ║
       ║  (•) JSON  ( ) Excel  ( ) CSV         ║
       ║                                       ║
       ║  选择文件:                            ║
       ║  ┌─────────────────────────────────┐ ║
       ║  │ 拖拽文件到此处                  │ ║
       ║  │ 或点击选择文件                  │ ║
       ║  └─────────────────────────────────┘ ║
       ║                                       ║
       ║  已选择: test-cases.json (25 KB)      ║
       ║                                       ║
       ║  目标文件夹:                          ║
       ║  [▼ Root / 项目A / 模块1]             ║
       ║                                       ║
       ║  冲突处理:                            ║
       ║  (•) 跳过重复  ( ) 覆盖  ( ) 重命名   ║
       ║                                       ║
       ║  [   开始导入   ]  [   取消   ]       ║
       ║                                       ║
       ║  导入进度: [████████░░] 80% (16/20)   ║
       ╚═══════════════════════════════════════╝
```

**说明**: 支持从外部文件批量导入测试用例，包含进度显示和冲突处理。

### 子功能 6: 用例导出对话框

```
       ╔═══════════════════════════════════════╗
       ║  导出测试用例                    [×]  ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  导出范围:                            ║
       ║  (•) 当前文件夹 (10 个用例)           ║
       ║  ( ) 选中的用例 (5 个)                ║
       ║  ( ) 全部用例 (45 个)                 ║
       ║                                       ║
       ║  导出格式:                            ║
       ║  (•) JSON   ( ) Excel   ( ) CSV       ║
       ║                                       ║
       ║  包含内容:                            ║
       ║  [✓] 用例基本信息                     ║
       ║  [✓] 测试步骤                         ║
       ║  [✓] 标签和元数据                     ║
       ║  [ ] 执行历史记录                     ║
       ║                                       ║
       ║  文件名:                              ║
       ║  [test-cases-2024-11-22______]        ║
       ║                                       ║
       ║  [   导出   ]      [   取消   ]       ║
       ╚═══════════════════════════════════════╝
```

**说明**: 支持灵活的导出选项，可选择导出范围、格式和内容。

### 子功能 7: 用例复制/克隆对话框

```
       ╔═══════════════════════════════════════╗
       ║  复制测试用例                    [×]  ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  源用例: TC-001 用户登录测试          ║
       ║                                       ║
       ║  新用例标题:                          ║
       ║  [用户登录测试（副本）___________]    ║
       ║                                       ║
       ║  目标文件夹:                          ║
       ║  [▼ Root / 项目A / 模块2]             ║
       ║                                       ║
       ║  复制选项:                            ║
       ║  [✓] 复制测试步骤                     ║
       ║  [✓] 复制标签                         ║
       ║  [ ] 复制测试数据                     ║
       ║  [ ] 复制执行历史                     ║
       ║                                       ║
       ║  [   创建副本   ]  [   取消   ]       ║
       ╚═══════════════════════════════════════╝
```

**说明**: 快速基于现有用例创建副本，支持选择性复制内容。

---

*此线框图由 ui-wireframe-generator skill 自动生成*
