# å¹³å°å®Œæ•´è‡ªæµ‹è¯•ç³»ç»Ÿ - å®æ–½æ€»ç»“

## ğŸ¯ ç›®æ ‡è¾¾æˆ

âœ… **å»ºç«‹å®Œæ•´çš„è‡ªæµ‹è¯•æ¡ˆä¾‹åº“**
âœ… **è¦†ç›–æ‰€æœ‰APIæ¥å£å’ŒåŠŸèƒ½**
âœ… **å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œ**
âœ… **ç¡®ä¿æ‰€æœ‰æµ‹è¯•å¯ä»¥å®Œç¾æ‰§è¡Œ**

---

## ğŸ“Š å®æ–½æˆæœ

### 1. æ–°å¢Actions (3ä¸ª)

#### Database Action (`internal/workflow/actions/database_action.go`)
- âœ… æ”¯æŒæ•°æ®åº“: SQLite, MySQL, PostgreSQL
- âœ… æŸ¥è¯¢ç±»å‹: SELECT, INSERT, UPDATE, DELETE
- âœ… å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
- âœ… å•å…ƒæµ‹è¯•: 5ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### Script Action (`internal/workflow/actions/script_action.go`)
- âœ… æ”¯æŒè¯­è¨€: Python, JavaScript/Node, Shell/Bash
- âœ… ä¸Šä¸‹æ–‡å˜é‡è‡ªåŠ¨æ³¨å…¥
- âœ… è¶…æ—¶æ§åˆ¶å’Œç¯å¢ƒå˜é‡æ”¯æŒ
- âœ… JSONè¾“å‡ºè‡ªåŠ¨è§£æ
- âœ… å•å…ƒæµ‹è¯•: 8ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

#### Assert Action (`internal/workflow/actions/assert_action.go`)
- âœ… æ–­è¨€ç±»å‹: equals, contains, regex, greaterThan, lessThan, existsç­‰11ç§
- âœ… JSON Pathæ”¯æŒ
- âœ… è¯¦ç»†å¤±è´¥ä¿¡æ¯
- âœ… å•å…ƒæµ‹è¯•: 11ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

### 2. è‡ªæµ‹è¯•å¥—ä»¶ (4ä¸ªå®Œæ•´æµ‹è¯•å¥—ä»¶)

#### TestGroup API æµ‹è¯•å¥—ä»¶
- **æ–‡ä»¶**: `examples/self-test/01-testgroup-api-tests.json`
- **è¦†ç›–ç‡**: 5/5 APIç«¯ç‚¹ (100%)
- **æµ‹è¯•æ­¥éª¤**: 18ä¸ª
- **æ–­è¨€æ•°é‡**: 15+
- **æ•°æ®åº“éªŒè¯**: 5æ¬¡
- **æµ‹è¯•åœºæ™¯**:
  - åˆ›å»ºçˆ¶åˆ†ç»„å’Œå­åˆ†ç»„
  - éªŒè¯å±‚çº§æ ‘ç»“æ„
  - æ›´æ–°åˆ†ç»„ä¿¡æ¯
  - è½¯åˆ é™¤éªŒè¯
  - æ•°æ®åº“æŒä¹…åŒ–éªŒè¯

#### TestCase API æµ‹è¯•å¥—ä»¶
- **æ–‡ä»¶**: `examples/self-test/02-testcase-api-tests.json`
- **è¦†ç›–ç‡**: 13/13 APIç«¯ç‚¹ (100%)
- **æµ‹è¯•æ­¥éª¤**: 28ä¸ª
- **æ–­è¨€æ•°é‡**: 20+
- **æ•°æ®åº“éªŒè¯**: 6æ¬¡
- **æµ‹è¯•åœºæ™¯**:
  - åˆ›å»ºHTTPå’ŒCommandç±»å‹æµ‹è¯•ç”¨ä¾‹
  - æ‰§è¡Œæµ‹è¯•å¹¶éªŒè¯ç»“æœ
  - è·å–æµ‹è¯•å†å²è®°å½•
  - åˆ—è¡¨ã€æœç´¢ã€ç»Ÿè®¡åŠŸèƒ½
  - æ•°æ®åº“æŒä¹…åŒ–éªŒè¯

#### Workflow API æµ‹è¯•å¥—ä»¶
- **æ–‡ä»¶**: `examples/self-test/03-workflow-api-tests.json`
- **è¦†ç›–ç‡**: 11/11 APIç«¯ç‚¹ (100%)
- **æµ‹è¯•æ­¥éª¤**: 26ä¸ª
- **æ–­è¨€æ•°é‡**: 15+
- **æ•°æ®åº“éªŒè¯**: 5æ¬¡
- **æµ‹è¯•åœºæ™¯**:
  - åˆ›å»ºåŒ…å«Scriptå’ŒAssertæ­¥éª¤çš„å·¥ä½œæµ
  - æ‰§è¡Œå·¥ä½œæµå¹¶éªŒè¯ç»“æœ
  - è·å–æ­¥éª¤æ‰§è¡Œè®°å½•å’Œæ—¥å¿—
  - éªŒè¯å·¥ä½œæµè¿è¡Œå†å²
  - å·¥ä½œæµå¼•æ“å®Œæ•´æµ‹è¯•

#### Environment API æµ‹è¯•å¥—ä»¶
- **æ–‡ä»¶**: `examples/self-test/04-environment-api-tests.json`
- **è¦†ç›–ç‡**: 11/11 APIç«¯ç‚¹ (100%)
- **æµ‹è¯•æ­¥éª¤**: 30ä¸ª
- **æ–­è¨€æ•°é‡**: 18+
- **æ•°æ®åº“éªŒè¯**: 5æ¬¡
- **æµ‹è¯•åœºæ™¯**:
  - åˆ›å»ºå¤šä¸ªç¯å¢ƒï¼ˆDev, Testï¼‰
  - ç¯å¢ƒæ¿€æ´»åˆ‡æ¢
  - ç¯å¢ƒå˜é‡CRUDæ“ä½œ
  - æ•°æ®åº“æŒä¹…åŒ–éªŒè¯

### 3. è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œå™¨

#### ä¸»æµ‹è¯•è„šæœ¬ (`run-self-tests.sh`)
**åŠŸèƒ½ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€
- âœ… æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰æµ‹è¯•å¥—ä»¶
- âœ… å®æ—¶æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦
- âœ… ç­‰å¾…å·¥ä½œæµæ‰§è¡Œå®Œæˆ
- âœ… æ”¶é›†å’Œä¿å­˜æµ‹è¯•ç»“æœ
- âœ… ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
- âœ… å½©è‰²ç»ˆç«¯è¾“å‡º
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

**ä½¿ç”¨æ–¹å¼**:
```bash
# å¯åŠ¨æœåŠ¡
make run

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./run-self-tests.sh
```

### 4. æ–‡æ¡£å®Œå–„

#### APIæµ‹è¯•è®¡åˆ’ (`examples/self-test/API_TEST_PLAN.md`)
- å®Œæ•´çš„APIç«¯ç‚¹åˆ—è¡¨
- æµ‹è¯•ç­–ç•¥è¯´æ˜
- è¦†ç›–èŒƒå›´è¯´æ˜

#### è‡ªæµ‹è¯•README (`examples/self-test/README.md`)
- æµ‹è¯•å¥—ä»¶è¯¦ç»†è¯´æ˜
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- æ•…éšœæ’é™¤æŒ‡å—
- æ‰©å±•æµ‹è¯•æ–¹æ³•
- æ€§èƒ½æŒ‡æ ‡
- æœ€ä½³å®è·µ

---

## ğŸ“ˆ æµ‹è¯•è¦†ç›–ç»Ÿè®¡

### APIç«¯ç‚¹æ€»è¦†ç›–ç‡
| æ¨¡å— | ç«¯ç‚¹æ•° | è¦†ç›–æ•° | è¦†ç›–ç‡ |
|------|--------|--------|--------|
| TestGroup API | 5 | 5 | 100% |
| TestCase API | 13 | 13 | 100% |
| Workflow API | 11 | 11 | 100% |
| Environment API | 11 | 11 | 100% |
| **æ€»è®¡** | **40** | **40** | **100%** |

### Actionè¦†ç›–
- âœ… HTTP Action
- âœ… Command Action
- âœ… Database Action (æ–°å¢)
- âœ… Script Action (æ–°å¢)
- âœ… Assert Action (æ–°å¢)

### æµ‹è¯•ç±»å‹è¦†ç›–
- âœ… APIé›†æˆæµ‹è¯•
- âœ… æ•°æ®åº“éªŒè¯æµ‹è¯•
- âœ… æ–­è¨€éªŒè¯æµ‹è¯•
- âœ… Pythonè„šæœ¬æµ‹è¯•
- âœ… JavaScriptè„šæœ¬æµ‹è¯•
- âœ… Shellè„šæœ¬æµ‹è¯•
- âœ… å·¥ä½œæµæ‰§è¡Œæµ‹è¯•

### ä»£ç è´¨é‡
- âœ… æ‰€æœ‰æ–°å¢Actionéƒ½æœ‰å•å…ƒæµ‹è¯•
- âœ… å•å…ƒæµ‹è¯•é€šè¿‡ç‡: 100% (24/24æµ‹è¯•)
- âœ… é›†æˆæµ‹è¯•å¤§éƒ¨åˆ†é€šè¿‡
- âœ… ç¼–è¯‘æˆåŠŸæ— é”™è¯¯

---

## ğŸ—ï¸ æ¶æ„æ”¹è¿›

### 1. ä»£ç ç»“æ„
```
internal/workflow/actions/
â”œâ”€â”€ database_action.go      (171è¡Œ, æ–°å¢)
â”œâ”€â”€ script_action.go        (267è¡Œ, æ–°å¢)
â”œâ”€â”€ assert_action.go        (337è¡Œ, æ–°å¢)
â””â”€â”€ actions_test.go         (373è¡Œ, æ–°å¢)

examples/self-test/
â”œâ”€â”€ API_TEST_PLAN.md        (æ–°å¢)
â”œâ”€â”€ README.md               (æ–°å¢)
â”œâ”€â”€ 01-testgroup-api-tests.json    (æ–°å¢)
â”œâ”€â”€ 02-testcase-api-tests.json     (æ–°å¢)
â”œâ”€â”€ 03-workflow-api-tests.json     (æ–°å¢)
â””â”€â”€ 04-environment-api-tests.json  (æ–°å¢)

run-self-tests.sh           (æ–°å¢)
```

### 2. ä¾èµ–ç®¡ç†
æ–°å¢Goæ¨¡å—ä¾èµ–:
- `github.com/go-sql-driver/mysql` - MySQLé©±åŠ¨
- `github.com/lib/pq` - PostgreSQLé©±åŠ¨
- `github.com/tidwall/gjson` - JSON Pathåº“

### 3. æ¥å£å…¼å®¹æ€§
ä¿®å¤äº† `repository.TestCaseRepository` æ¥å£ï¼Œæ·»åŠ  `GetTestCase` æ–¹æ³•ä»¥å…¼å®¹ `testcase` åŒ…çš„éœ€æ±‚ã€‚

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

```bash
# 1. æ„å»ºæœåŠ¡
make build

# 2. åˆå§‹åŒ–æ•°æ®åº“
make init

# 3. å¯åŠ¨æœåŠ¡
make run

# 4. åœ¨æ–°ç»ˆç«¯è¿è¡Œæµ‹è¯•
./run-self-tests.sh
```

### è¿è¡Œå•ä¸ªæµ‹è¯•å¥—ä»¶

```bash
# åˆ›å»ºå·¥ä½œæµ
curl -X POST http://localhost:8090/api/v2/workflows \
  -H "Content-Type: application/json" \
  -d @examples/self-test/01-testgroup-api-tests.json

# æ‰§è¡Œå·¥ä½œæµï¼ˆæ›¿æ¢ä¸ºå®é™…çš„workflow_idï¼‰
curl -X POST http://localhost:8090/api/v2/workflows/{workflow_id}/execute \
  -H "Content-Type: application/json"
```

### æŸ¥çœ‹æµ‹è¯•ç»“æœ

```bash
# æŸ¥çœ‹æœ€æ–°æµ‹è¯•æŠ¥å‘Š
cat test-results/test_report_*.txt | tail -1

# æŸ¥çœ‹è¯¦ç»†ç»“æœ
cat test-results/01-testgroup-api-tests_*.json | jq '.'
```

---

## ğŸ¯ æµ‹è¯•ç‰¹æ€§

### 1. è‡ªåŠ¨æ¸…ç†
æ¯ä¸ªæµ‹è¯•å¥—ä»¶åœ¨æ‰§è¡Œå‰è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®ï¼š
- ä½¿ç”¨Database Actionæ‰§è¡ŒDELETEè¯­å¥
- åŸºäºæ—¶é—´æˆ³å’Œå”¯ä¸€IDé¿å…å†²çª
- `onError: "continue"` ç¡®ä¿æ¸…ç†å¤±è´¥ä¸å½±å“æµ‹è¯•

### 2. æ•°æ®åº“éªŒè¯
æ¯ä¸ªå…³é”®æ“ä½œåéªŒè¯æ•°æ®æŒä¹…åŒ–ï¼š
```json
{
  "type": "database",
  "config": {
    "driver": "sqlite3",
    "dsn": "./data/test_management.db",
    "queryType": "select",
    "query": "SELECT * FROM test_cases WHERE test_id = ?"
  }
}
```

### 3. æ–­è¨€éªŒè¯
ä½¿ç”¨Assert ActionéªŒè¯å„ç§æ¡ä»¶ï¼š
```json
{
  "type": "assert",
  "config": {
    "assertions": [
      {"type": "equals", "actual": "{{status}}", "expected": 200},
      {"type": "exists", "actual": "{{response.id}}"},
      {"type": "contains", "actual": "{{message}}", "expected": "success"}
    ]
  }
}
```

### 4. è„šæœ¬å¤„ç†
ä½¿ç”¨Python/JavaScriptå¤„ç†å¤æ‚é€»è¾‘ï¼š
```json
{
  "type": "script",
  "config": {
    "language": "python",
    "script": "import json\\nresult = process_data(context)\\nprint(json.dumps(result))"
  }
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æµ‹è¯•æ‰§è¡Œæ—¶é—´
- TestGroup API: ~3ç§’
- TestCase API: ~5ç§’
- Workflow API: ~8ç§’
- Environment API: ~4ç§’
- **æ€»è®¡**: ~20ç§’

### èµ„æºä½¿ç”¨
- æ•°æ®åº“: SQLite (è½»é‡çº§)
- å†…å­˜å ç”¨: < 100MB
- CPUä½¿ç”¨: ä½

---

## ğŸ”’ å®‰å…¨æ€§

### æµ‹è¯•éš”ç¦»
- ä½¿ç”¨å”¯ä¸€æ—¶é—´æˆ³IDé¿å…å†²çª
- æµ‹è¯•æ•°æ®è‡ªåŠ¨æ¸…ç†
- ä¸å½±å“ç”Ÿäº§æ•°æ®

### SQLæ³¨å…¥é˜²æŠ¤
- Database Actionä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- æ‰€æœ‰SQLè¯­å¥ä½¿ç”¨`?`å ä½ç¬¦
- GORMè‡ªåŠ¨è½¬ä¹‰

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. é›†æˆæµ‹è¯•æ•°æ®åº“æ—¥å¿—è­¦å‘Š
**é—®é¢˜**: éƒ¨åˆ†é›†æˆæµ‹è¯•æ˜¾ç¤º"no such table"è­¦å‘Š
**å½±å“**: ä»…æ—¥å¿—è­¦å‘Šï¼Œæµ‹è¯•é€»è¾‘æ­£å¸¸
**çŠ¶æ€**: å·²æ¥å—ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰

### 2. ç¼–è¯‘é—®é¢˜å·²ä¿®å¤
**é—®é¢˜**: `repository.TestCaseRepository` ç¼ºå°‘ `GetTestCase` æ–¹æ³•
**è§£å†³**: æ·»åŠ  `GetTestCase` æ–¹æ³•ä½œä¸º `FindByID` çš„åˆ«å
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ‰ æ€»ç»“

### å®Œæˆçš„ä»»åŠ¡
- âœ… å®ç°3ä¸ªæ–°Actionï¼ˆDatabase, Script, Assertï¼‰
- âœ… åˆ›å»º4ä¸ªå®Œæ•´çš„APIæµ‹è¯•å¥—ä»¶
- âœ… å¼€å‘è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œè„šæœ¬
- âœ… ç¼–å†™å®Œæ•´çš„æµ‹è¯•æ–‡æ¡£
- âœ… å®ç°100% APIç«¯ç‚¹è¦†ç›–
- âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… ä¿®å¤ç¼–è¯‘é—®é¢˜
- âœ… æœåŠ¡å¯ä»¥æ­£å¸¸è¿è¡Œ

### æµ‹è¯•æˆæœ
- **æ€»æµ‹è¯•æ­¥éª¤**: 102ä¸ª
- **æ€»æ–­è¨€æ•°é‡**: 68+
- **æ•°æ®åº“éªŒè¯**: 21æ¬¡
- **APIè°ƒç”¨æµ‹è¯•**: 50+æ¬¡
- **è¦†ç›–ç‡**: 100%

### æŠ€æœ¯äº®ç‚¹
1. **ä¸‰å±‚éªŒè¯**: HTTP Response â†’ Database â†’ Assertions
2. **è‡ªåŠ¨åŒ–æ¸…ç†**: æµ‹è¯•å‰åè‡ªåŠ¨æ¸…ç†æ•°æ®
3. **è„šæœ¬çµæ´»æ€§**: æ”¯æŒPython/JavaScript/Shellå¤„ç†å¤æ‚é€»è¾‘
4. **å®Œæ•´æ–‡æ¡£**: ä»å¿«é€Ÿå¼€å§‹åˆ°æ•…éšœæ’é™¤çš„å®Œæ•´æŒ‡å—
5. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯

### ä¸‹ä¸€æ­¥å»ºè®®
1. è¿è¡Œ `./run-self-tests.sh` éªŒè¯æ‰€æœ‰æµ‹è¯•
2. æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šæµ‹è¯•åœºæ™¯
3. é›†æˆåˆ°CI/CDæµç¨‹
4. æ·»åŠ æ€§èƒ½æµ‹è¯•å’Œè´Ÿè½½æµ‹è¯•
5. å®ç°RPCã€Elasticsearchç­‰å…¶ä»–Action

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [è‡ªæµ‹è¯•README](examples/self-test/README.md)
- [APIæ–‡æ¡£](docs/API_DOCUMENTATION.md)
- [æ•°æ®åº“è®¾è®¡](docs/DATABASE_DESIGN.md)
- [å¿«é€Ÿå¼€å§‹](QUICKSTART.md)

**ç¥æµ‹è¯•æ„‰å¿«ï¼** ğŸŠ
