# 1.2.2 设计示意图 - 仪表盘

## 功能描述

系统首页仪表盘，展示测试执行的关键统计指标、图表数据和 AI 智能分析。用户可以快速了解测试状态，导出测试报告，查看历史趋势。

## 页面结构

```
╔═══════════════════════════════════════════════════════════════════════╗
║  仪表盘                                           [导出报告]         ║
║  Test execution overview and insights                                ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ ║
║  │   通过      │  │   失败      │  │   阻塞      │  │   跳过      │ ║
║  │             │  │             │  │             │  │             │ ║
║  │    40       │  │    24       │  │     5       │  │     3       │ ║
║  │   ✓ 56%     │  │   ✗ 33%     │  │   ⚠ 7%      │  │   ⊘ 4%      │ ║
║  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ ║
║                                                                       ║
║  ┌────────────────────────────────────────────────────────────────┐  ║
║  │  💡 AI 智能分析                                               │  ║
║  │                                                                │  ║
║  │  [分析中...] / [分析结果文本显示区域]                         │  ║
║  │  - 识别出的问题模式                                            │  ║
║  │  - 改进建议                                                    │  ║
║  └────────────────────────────────────────────────────────────────┘  ║
║                                                                       ║
║  ┌──────────────────────────┐  ┌──────────────────────────────────┐ ║
║  │   测试结果分布 (饼图)     │  │   历史趋势 (柱状图)              │ ║
║  │                          │  │                                  │ ║
║  │      Passed: 56%         │  │  Sprint 1  Sprint 2  Current     │ ║
║  │      Failed: 33%         │  │    ████      ████      ████      │ ║
║  │      Blocked: 7%         │  │    ████      ████      ████      │ ║
║  │      Skipped: 4%         │  │   Passed    Failed                │ ║
║  │                          │  │                                  │ ║
║  └──────────────────────────┘  └──────────────────────────────────┘ ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝
```

## 交互流程

- 页面加载 → 自动获取测试执行数据
- 数据加载完成 → 渲染统计卡片和图表
- 自动触发 AI 分析 → 调用 Gemini API 生成洞察
- 点击"导出报告" → 打开导出对话框 → 选择格式（PDF/Excel/JSON）
- 可以点击图表元素 → 查看详细数据

## 数据字段

| 字段名 | 类型 | 校验规则 | 说明 |
|--------|------|----------|------|
| stats.passed | number | ≥0 | 通过的测试数量 |
| stats.failed | number | ≥0 | 失败的测试数量 |
| stats.blocked | number | ≥0 | 阻塞的测试数量 |
| stats.skipped | number | ≥0 | 跳过的测试数量 |
| stats.total | number | >0 | 总测试数量 |
| passRate | number | 0-100 | 通过率百分比 |
| aiInsight | string | - | AI 分析结果文本 |
| pieData | array | - | 饼图数据 |
| barData | array | - | 柱状图历史数据 |

## 权限说明

- 访问权限：已登录用户
- 权限要求：VIEW_DASHBOARD 权限
- 数据范围：仅显示当前项目的测试数据
- 多租户隔离：根据 activeProjectId 过滤数据

## 后端 API 依赖

- `GET /api/runs` - 获取测试执行记录列表
- `POST /api/gemini/analyze` - 调用 Gemini AI 分析测试数据（可选，可能是前端直接调用）

## 实现建议

- 使用 Recharts 库绘制图表（饼图、柱状图）
- 统计数据使用 useMemo 优化计算性能
- AI 分析使用 useEffect 自动触发，避免重复调用
- 导出功能可以使用 jsPDF 或 ExcelJS 库
- 图表配色使用预定义的主题色（绿、红、黄、灰）
- 实现响应式布局，适配不同屏幕尺寸
- AI 分析失败时显示友好的降级信息

## 测试要点

- [ ] 页面加载时正确显示统计数据
- [ ] 通过率计算准确
- [ ] 饼图和柱状图正确渲染
- [ ] AI 分析成功获取并显示
- [ ] AI 分析失败时显示默认文本
- [ ] 导出报告功能正常工作
- [ ] 不同格式导出内容正确
- [ ] 无数据时显示空状态提示
- [ ] 数据更新时图表自动刷新
- [ ] 多租户数据隔离正确

### 子功能 1: 导出报告对话框

```
       ╔═══════════════════════════════════════╗
       ║  导出测试报告                  [×]    ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  导出格式:                            ║
       ║  (•) PDF 报告                         ║
       ║  ( ) Excel 表格                       ║
       ║  ( ) JSON 数据                        ║
       ║                                       ║
       ║  时间范围:                            ║
       ║  [▼ 最近7天]                          ║
       ║                                       ║
       ║  包含内容:                            ║
       ║  [✓] 执行统计                         ║
       ║  [✓] 详细日志                         ║
       ║  [✓] AI 分析结果                      ║
       ║  [✓] 趋势图表                         ║
       ║                                       ║
       ║  [   导出   ]      [   取消   ]       ║
       ╚═══════════════════════════════════════╝
```

**说明**: 支持多种格式导出测试报告，包含统计数据、图表和 AI 分析结果。使用 jsPDF 生成 PDF，ExcelJS 生成 Excel。

---

*此线框图由 ui-wireframe-generator skill 自动生成*
