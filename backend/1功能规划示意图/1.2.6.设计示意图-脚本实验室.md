# 1.2.6 设计示意图 - 脚本实验室

## 功能描述

编写和管理自动化测试脚本和工作流。支持多种脚本类型（HTTP、Command、Shell）、工作流编排、变量管理、版本控制。提供代码编辑器和实时预览功能。

## 页面结构

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║  脚本实验室                            [脚本] [工作流]                        ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  ┌─────────────────────┬─────────────────────────────────────────────────┐   ║
║  │  脚本列表            │  编辑器                                         │   ║
║  │                     │                                                 │   ║
║  │  [+新建]  [搜索___] │  脚本名称: [_____________________]              │   ║
║  │                     │                                                 │   ║
║  │  ┌────────────────┐ │  类型: [▼ HTTP Request]                        │   ║
║  │  │ API-Login      │ │                                                 │   ║
║  │  │ Type: HTTP     │ │  ┌────────────────────────────────────────────┐ │   ║
║  │  │ Updated: 11/22 │ │  │  Code Editor                               │ │   ║
║  │  └────────────────┘ │  │  {                                         │ │   ║
║  │                     │  │    "url": "{{API_BASE}}/auth/login",       │ │   ║
║  │  ┌────────────────┐ │  │    "method": "POST",                       │ │   ║
║  │  │ DB-Query       │ │  │    "headers": {                            │ │   ║
║  │  │ Type: Command  │ │  │      "Content-Type": "application/json"    │ │   ║
║  │  │ Updated: 11/21 │ │  │    },                                      │ │   ║
║  │  └────────────────┘ │  │    "body": {                               │ │   ║
║  │                     │  │      "username": "{{USERNAME}}",           │ │   ║
║  │  ┌────────────────┐ │  │      "password": "{{PASSWORD}}"            │ │   ║
║  │  │ Deploy-Script  │ │  │    }                                       │ │   ║
║  │  │ Type: Shell    │ │  │  }                                         │ │   ║
║  │  │ Updated: 11/20 │ │  └────────────────────────────────────────────┘ │   ║
║  │  └────────────────┘ │                                                 │   ║
║  │                     │  变量: {{API_BASE}}  {{USERNAME}}  {{PASSWORD}}  │   ║
║  │                     │                                                 │   ║
║  │                     │  [测试运行]  [保存]  [删除]                     │   ║
║  └─────────────────────┴─────────────────────────────────────────────────┘   ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

## 交互流程

- 切换标签 → 显示脚本或工作流列表
- 点击脚本 → 右侧显示编辑器，加载脚本内容
- 点击"新建" → 创建新脚本/工作流
- 编辑代码 → 实时语法高亮和验证
- 点击"测试运行" → 执行脚本并显示结果
- 点击"保存" → 保存修改
- 工作流模式 → 显示可视化流程编排器

## 数据字段

| 字段名 | 类型 | 校验规则 | 说明 |
|--------|------|----------|------|
| id | string | 唯一 | 脚本ID |
| name | string | 必填，1-50字符 | 脚本名称 |
| type | enum | HTTP/COMMAND/SHELL | 脚本类型 |
| content | object/string | 必填 | 脚本内容 |
| variables | array | - | 使用的变量列表 |
| projectId | string | 必填 | 所属项目 |

## 权限说明

- 访问权限：已登录用户
- 权限要求：VIEW_AUTOMATION 权限（查看）、EDIT_AUTOMATION 权限（编辑）
- 数据范围：当前项目的脚本

## 后端 API 依赖

- `GET /api/scripts` - 获取脚本列表
- `POST /api/scripts` - 创建脚本
- `PUT /api/scripts/:id` - 更新脚本
- `DELETE /api/scripts/:id` - 删除脚本
- `POST /api/scripts/:id/execute` - 测试执行脚本

## 实现建议

- 使用 Monaco Editor 或 CodeMirror 作为代码编辑器
- 支持语法高亮（JSON、YAML、Shell）
- 变量高亮显示（{{VAR}}格式）
- 实现代码自动格式化
- 工作流使用流程图库（如 React Flow）
- 支持代码片段和模板
- 实现撤销/重做功能

## 测试要点

- [ ] 脚本列表正确显示
- [ ] 编辑器语法高亮正常
- [ ] 保存脚本成功
- [ ] 测试运行功能正常
- [ ] 变量替换正确
- [ ] 代码格式化功能正常
- [ ] 删除脚本提示确认
- [ ] 工作流可视化编辑正常

### 子功能 1: 工作流可视化编辑器

```
╔═══════════════════════════════════════════════╗
║  工作流编辑器: 用户认证流程      [保存] [×]  ║
╠═══════════════════════════════════════════════╣
║                                               ║
║  工具栏: [➕节点] [🔗连线] [✂️ 删除] [💾保存]   ║
║                                               ║
║          ┌───────────┐                        ║
║          │ 开始节点  │                        ║
║          └─────┬─────┘                        ║
║                │                              ║
║          ┌─────▼─────┐                        ║
║          │ HTTP 节点 │  ← 拖拽配置             ║
║          │ 用户登录  │                        ║
║          └─────┬─────┘                        ║
║                │                              ║
║          ┌─────▼─────┐                        ║
║          │ 条件节点  │                        ║
║          │ 登录成功? │                        ║
║          └───┬───┬───┘                        ║
║              │   │                            ║
║        Yes   │   │  No                        ║
║    ┌─────────┘   └─────────┐                 ║
║    │                        │                 ║
║ ┌──▼───┐              ┌────▼────┐            ║
║ │成功处理│              │错误处理 │            ║
║ └──────┘              └─────────┘            ║
║                                               ║
║  属性面板:                                    ║
║  节点类型: HTTP Request                       ║
║  URL: {{API_BASE}}/auth/login                 ║
║  Method: POST                                 ║
║  [保存节点]                                   ║
╚═══════════════════════════════════════════════╝
```

**说明**: 拖拽式工作流编辑器，支持多种节点类型（HTTP、条件、循环等）和连线配置。

### 子功能 2: 测试运行结果对话框

```
       ╔═══════════════════════════════════════╗
       ║  脚本测试运行结果              [×]    ║
       ╠═══════════════════════════════════════╣
       ║                                       ║
       ║  脚本: API-Login                      ║
       ║  状态: ✓ 成功                         ║
       ║  耗时: 1.2s                           ║
       ║                                       ║
       ║  请求:                                ║
       ║  POST /api/auth/login                 ║
       ║  {                                    ║
       ║    "username": "admin",               ║
       ║    "password": "******"               ║
       ║  }                                    ║
       ║                                       ║
       ║  响应:                                ║
       ║  Status: 200 OK                       ║
       ║  {                                    ║
       ║    "token": "eyJ...",                 ║
       ║    "user": {...}                      ║
       ║  }                                    ║
       ║                                       ║
       ║  [复制响应]  [关闭]                   ║
       ╚═══════════════════════════════════════╝
```

---

*此线框图由 ui-wireframe-generator skill 自动生成*
