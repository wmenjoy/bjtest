{
  "name": "End-to-End Integration Test Suite (Multi-Tenant)",
  "version": "2.0.0",
  "description": "Comprehensive end-to-end test demonstrating full platform capabilities with multi-tenant isolation",
  "variables": {
    "baseUrl": "http://localhost:8090/api",
    "dbPath": "./data/test_management.db",
    "tenantId": "",
    "projectId": "",
    "devEnvId": "",
    "testEnvId": "",
    "parentGroupId": "",
    "childGroupId": "",
    "httpTestId": "",
    "workflowTestId": "",
    "workflowId": "",
    "runId": "",
    "timestamp": ""
  },
  "steps": {
    "generateTimestamp": {
      "id": "generateTimestamp",
      "name": "Generate Unique IDs",
      "type": "script",
      "config": {
        "language": "python",
        "script": "import json\nimport datetime\nimport random\n\nts = datetime.datetime.now().strftime('%Y%m%d%H%M%S')\nrand_suffix = random.randint(1000, 9999)\n\nresult = {\n    'timestamp': f'{ts}{rand_suffix}',\n    'tenant_id': f'tenant-e2e-{ts}',\n    'project_id': f'project-e2e-{ts}',\n    'dev_env_id': f'dev-env-{ts}',\n    'test_env_id': f'test-env-{ts}',\n    'parent_group_id': f'parent-group-{ts}',\n    'child_group_id': f'child-group-{ts}',\n    'http_test_id': f'http-test-{ts}{rand_suffix}',\n    'workflow_test_id': f'workflow-test-{ts}{rand_suffix}',\n    'workflow_id': f'e2e-workflow-{ts}{rand_suffix}'\n}\n\nprint(json.dumps(result))",
        "timeout": 5
      },
      "output": {
        "timestamp": "output.timestamp",
        "tenantId": "output.tenant_id",
        "projectId": "output.project_id",
        "devEnvId": "output.dev_env_id",
        "testEnvId": "output.test_env_id",
        "parentGroupId": "output.parent_group_id",
        "childGroupId": "output.child_group_id",
        "httpTestId": "output.http_test_id",
        "workflowTestId": "output.workflow_test_id",
        "workflowId": "output.workflow_id"
      }
    },

    "cleanupOldData": {
      "id": "cleanupOldData",
      "name": "Cleanup Old Test Data",
      "type": "database",
      "dependsOn": ["generateTimestamp"],
      "config": {
        "driver": "sqlite3",
        "dsn": "{{dbPath}}",
        "queryType": "exec",
        "query": "DELETE FROM workflow_runs WHERE tenant_id LIKE 'tenant-e2e-%'; DELETE FROM workflows WHERE tenant_id LIKE 'tenant-e2e-%'; DELETE FROM test_cases WHERE tenant_id LIKE 'tenant-e2e-%'; DELETE FROM test_groups WHERE tenant_id LIKE 'tenant-e2e-%'; DELETE FROM environments WHERE tenant_id LIKE 'tenant-e2e-%'; DELETE FROM projects WHERE tenant_id LIKE 'tenant-e2e-%'; DELETE FROM tenants WHERE tenant_id LIKE 'tenant-e2e-%';"
      },
      "onError": "continue"
    },

    "createTenant": {
      "id": "createTenant",
      "name": "[Setup] Create E2E Test Tenant",
      "type": "database",
      "dependsOn": ["cleanupOldData"],
      "config": {
        "driver": "sqlite3",
        "dsn": "{{dbPath}}",
        "queryType": "exec",
        "query": "INSERT INTO tenants (tenant_id, name, display_name, description, status, max_projects, max_users, max_test_cases) VALUES (?, 'E2E Test Tenant', 'End-to-End Test Tenant', 'Tenant for comprehensive E2E testing', 'active', 10, 50, 1000)",
        "args": ["{{generateTimestamp.output.tenant_id}}"]
      }
    },

    "createProject": {
      "id": "createProject",
      "name": "[Setup] Create E2E Test Project",
      "type": "database",
      "dependsOn": ["createTenant"],
      "config": {
        "driver": "sqlite3",
        "dsn": "{{dbPath}}",
        "queryType": "exec",
        "query": "INSERT INTO projects (project_id, tenant_id, name, display_name, description, status) VALUES (?, ?, 'E2E Test Project', 'End-to-End Test Project', 'Project for comprehensive E2E testing', 'active')",
        "args": ["{{generateTimestamp.output.project_id}}", "{{generateTimestamp.output.tenant_id}}"]
      }
    },

    "createDevEnvironment": {
      "id": "createDevEnvironment",
      "name": "[Env] Create Development Environment",
      "type": "http",
      "dependsOn": ["createProject"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/environments",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "env_id": "{{generateTimestamp.output.dev_env_id}}",
          "name": "Development",
          "description": "Development environment for E2E testing",
          "is_active": true,
          "config": {
            "baseUrl": "https://jsonplaceholder.typicode.com",
            "timeout": 10000
          },
          "variables": {
            "API_URL": "https://jsonplaceholder.typicode.com",
            "ENV_NAME": "development",
            "RETRY_COUNT": "3"
          }
        },
        "timeout": 5000
      }
    },

    "assertDevEnvCreated": {
      "id": "assertDevEnvCreated",
      "name": "[Assert] Verify Dev Environment",
      "type": "assert",
      "dependsOn": ["createDevEnvironment"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{createDevEnvironment.status}}",
            "expected": 201,
            "message": "Create environment should return 201"
          },
          {
            "type": "equals",
            "actual": "{{createDevEnvironment.response.tenant_id}}",
            "expected": "{{generateTimestamp.output.tenant_id}}",
            "message": "Tenant ID should match"
          }
        ]
      }
    },

    "createParentGroup": {
      "id": "createParentGroup",
      "name": "[Group] Create Parent Test Group",
      "type": "http",
      "dependsOn": ["assertDevEnvCreated"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/groups",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "group_id": "{{generateTimestamp.output.parent_group_id}}",
          "name": "API Tests",
          "description": "Parent group for all API tests",
          "parent_id": null
        },
        "timeout": 5000
      }
    },

    "createChildGroup": {
      "id": "createChildGroup",
      "name": "[Group] Create Child Test Group",
      "type": "http",
      "dependsOn": ["createParentGroup"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/groups",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "group_id": "{{generateTimestamp.output.child_group_id}}",
          "name": "User API Tests",
          "description": "Tests for user management APIs",
          "parent_id": "{{generateTimestamp.output.parent_group_id}}"
        },
        "timeout": 5000
      }
    },

    "assertGroupHierarchy": {
      "id": "assertGroupHierarchy",
      "name": "[Assert] Verify Group Hierarchy",
      "type": "assert",
      "dependsOn": ["createChildGroup"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{createChildGroup.status}}",
            "expected": 201,
            "message": "Create child group should return 201"
          },
          {
            "type": "equals",
            "actual": "{{createChildGroup.response.parent_id}}",
            "expected": "{{generateTimestamp.output.parent_group_id}}",
            "message": "Parent ID should match"
          }
        ]
      }
    },

    "createHTTPTestCase": {
      "id": "createHTTPTestCase",
      "name": "[TestCase] Create HTTP Test",
      "type": "http",
      "dependsOn": ["assertGroupHierarchy"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/tests",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "test_id": "{{generateTimestamp.output.http_test_id}}",
          "name": "Get User Test",
          "type": "http",
          "group_id": "{{generateTimestamp.output.child_group_id}}",
          "description": "Test getting user by ID",
          "http_config": {
            "method": "GET",
            "url": "https://jsonplaceholder.typicode.com/users/1",
            "headers": {
              "Accept": "application/json"
            },
            "timeout": 5000
          },
          "assertions": [
            {
              "type": "status_code",
              "expected": 200
            },
            {
              "type": "json_path",
              "path": "$.id",
              "expected": 1
            },
            {
              "type": "json_path",
              "path": "$.name",
              "expected": "Leanne Graham"
            }
          ]
        },
        "timeout": 5000
      }
    },

    "assertHTTPTestCreated": {
      "id": "assertHTTPTestCreated",
      "name": "[Assert] Verify HTTP Test Created",
      "type": "assert",
      "dependsOn": ["createHTTPTestCase"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{createHTTPTestCase.status}}",
            "expected": 201,
            "message": "Create test should return 201"
          },
          {
            "type": "equals",
            "actual": "{{createHTTPTestCase.response.group_id}}",
            "expected": "{{generateTimestamp.output.child_group_id}}",
            "message": "Test should belong to child group"
          }
        ]
      }
    },

    "executeHTTPTest": {
      "id": "executeHTTPTest",
      "name": "[TestCase] Execute HTTP Test",
      "type": "http",
      "dependsOn": ["assertHTTPTestCreated"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/tests/{{generateTimestamp.output.http_test_id}}/execute",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "timeout": 10000
      },
      "output": {
        "httpResultId": "response.result_id"
      }
    },

    "assertHTTPTestPassed": {
      "id": "assertHTTPTestPassed",
      "name": "[Assert] Verify HTTP Test Passed",
      "type": "assert",
      "dependsOn": ["executeHTTPTest"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{executeHTTPTest.status}}",
            "expected": 200,
            "message": "Execute test should return 200"
          },
          {
            "type": "exists",
            "actual": "{{executeHTTPTest.response.result_id}}",
            "message": "Result ID should exist"
          }
        ]
      }
    },

    "createWorkflow": {
      "id": "createWorkflow",
      "name": "[Workflow] Create E2E Test Workflow",
      "type": "http",
      "dependsOn": ["assertHTTPTestPassed"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/workflows",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "workflow_id": "{{generateTimestamp.output.workflow_id}}",
          "name": "E2E Integration Workflow",
          "description": "Workflow demonstrating API integration",
          "version": "1.0.0",
          "definition": {
            "variables": {
              "userId": "1",
              "expectedName": "Leanne Graham"
            },
            "steps": {
              "fetchUser": {
                "id": "fetchUser",
                "name": "Fetch User Data",
                "type": "http",
                "config": {
                  "method": "GET",
                  "url": "https://jsonplaceholder.typicode.com/users/{{userId}}",
                  "headers": {
                    "Accept": "application/json"
                  },
                  "timeout": 5000
                },
                "output": {
                  "userName": "response.name",
                  "userEmail": "response.email",
                  "userId": "response.id"
                }
              },
              "validateUser": {
                "id": "validateUser",
                "name": "Validate User Data",
                "type": "assert",
                "dependsOn": ["fetchUser"],
                "config": {
                  "assertions": [
                    {
                      "type": "equals",
                      "actual": "{{fetchUser.output.userName}}",
                      "expected": "{{expectedName}}",
                      "message": "User name should match"
                    },
                    {
                      "type": "equals",
                      "actual": "{{fetchUser.status}}",
                      "expected": 200,
                      "message": "HTTP status should be 200"
                    }
                  ]
                }
              },
              "fetchPosts": {
                "id": "fetchPosts",
                "name": "Fetch User Posts",
                "type": "http",
                "dependsOn": ["validateUser"],
                "config": {
                  "method": "GET",
                  "url": "https://jsonplaceholder.typicode.com/posts?userId={{fetchUser.output.userId}}",
                  "headers": {
                    "Accept": "application/json"
                  },
                  "timeout": 5000
                },
                "output": {
                  "postCount": "response.length"
                }
              },
              "validatePosts": {
                "id": "validatePosts",
                "name": "Validate Post Count",
                "type": "assert",
                "dependsOn": ["fetchPosts"],
                "config": {
                  "assertions": [
                    {
                      "type": "greater_than",
                      "actual": "{{fetchPosts.output.postCount}}",
                      "expected": 0,
                      "message": "User should have at least one post"
                    }
                  ]
                }
              }
            }
          }
        },
        "timeout": 5000
      }
    },

    "assertWorkflowCreated": {
      "id": "assertWorkflowCreated",
      "name": "[Assert] Verify Workflow Created",
      "type": "assert",
      "dependsOn": ["createWorkflow"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{createWorkflow.status}}",
            "expected": 201,
            "message": "Create workflow should return 201"
          },
          {
            "type": "equals",
            "actual": "{{createWorkflow.response.tenant_id}}",
            "expected": "{{generateTimestamp.output.tenant_id}}",
            "message": "Tenant ID should match"
          }
        ]
      }
    },

    "executeWorkflow": {
      "id": "executeWorkflow",
      "name": "[Workflow] Execute E2E Workflow",
      "type": "http",
      "dependsOn": ["assertWorkflowCreated"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/workflows/{{generateTimestamp.output.workflow_id}}/execute",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "input": {}
        },
        "timeout": 15000
      },
      "output": {
        "runId": "response.run_id"
      }
    },

    "assertWorkflowExecuted": {
      "id": "assertWorkflowExecuted",
      "name": "[Assert] Verify Workflow Execution Started",
      "type": "assert",
      "dependsOn": ["executeWorkflow"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{executeWorkflow.status}}",
            "expected": 200,
            "message": "Execute workflow should return 200"
          },
          {
            "type": "exists",
            "actual": "{{executeWorkflow.response.run_id}}",
            "message": "Run ID should exist"
          }
        ]
      }
    },

    "waitForWorkflowCompletion": {
      "id": "waitForWorkflowCompletion",
      "name": "[Wait] Wait for Workflow Completion",
      "type": "script",
      "dependsOn": ["assertWorkflowExecuted"],
      "config": {
        "language": "shell",
        "script": "sleep 5\necho '{\"waited\": true, \"seconds\": 5}'",
        "timeout": 10
      }
    },

    "getWorkflowRun": {
      "id": "getWorkflowRun",
      "name": "[Workflow] Get Workflow Run Results",
      "type": "http",
      "dependsOn": ["waitForWorkflowCompletion"],
      "config": {
        "method": "GET",
        "url": "{{baseUrl}}/workflows/runs/{{executeWorkflow.response.run_id}}",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "timeout": 5000
      }
    },

    "assertWorkflowSuccess": {
      "id": "assertWorkflowSuccess",
      "name": "[Assert] Verify Workflow Succeeded",
      "type": "assert",
      "dependsOn": ["getWorkflowRun"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{getWorkflowRun.status}}",
            "expected": 200,
            "message": "Get workflow run should return 200"
          },
          {
            "type": "exists",
            "actual": "{{getWorkflowRun.response.status}}",
            "message": "Run status should exist"
          }
        ]
      }
    },

    "getStepExecutions": {
      "id": "getStepExecutions",
      "name": "[Workflow] Get Step Executions",
      "type": "http",
      "dependsOn": ["assertWorkflowSuccess"],
      "config": {
        "method": "GET",
        "url": "{{baseUrl}}/workflows/runs/{{executeWorkflow.response.run_id}}/steps",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "timeout": 5000
      }
    },

    "validateStepExecutions": {
      "id": "validateStepExecutions",
      "name": "[Script] Validate Step Execution Count",
      "type": "script",
      "dependsOn": ["getStepExecutions"],
      "config": {
        "language": "python",
        "script": "import json\n\nsteps = context.get('getStepExecutions', {}).get('response', [])\nexpected_steps = ['fetchUser', 'validateUser', 'fetchPosts', 'validatePosts']\n\nstep_ids = [s.get('step_id') for s in steps]\nall_found = all(sid in step_ids for sid in expected_steps)\n\nresult = {\n    'total_steps': len(steps),\n    'expected_steps': len(expected_steps),\n    'all_steps_found': all_found,\n    'step_ids': step_ids\n}\n\nprint(json.dumps(result))",
        "timeout": 5
      }
    },

    "assertAllStepsExecuted": {
      "id": "assertAllStepsExecuted",
      "name": "[Assert] Verify All Steps Executed",
      "type": "assert",
      "dependsOn": ["validateStepExecutions"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{validateStepExecutions.output.all_steps_found}}",
            "expected": true,
            "message": "All workflow steps should be executed"
          },
          {
            "type": "equals",
            "actual": "{{validateStepExecutions.output.total_steps}}",
            "expected": 4,
            "message": "Should have 4 step executions"
          }
        ]
      }
    },

    "verifyTenantIsolationInDB": {
      "id": "verifyTenantIsolationInDB",
      "name": "[DB] Verify Tenant Isolation",
      "type": "database",
      "dependsOn": ["assertAllStepsExecuted"],
      "config": {
        "driver": "sqlite3",
        "dsn": "{{dbPath}}",
        "queryType": "select",
        "query": "SELECT 'environments' as table_name, COUNT(*) as count FROM environments WHERE tenant_id = ? AND deleted_at IS NULL UNION ALL SELECT 'test_groups', COUNT(*) FROM test_groups WHERE tenant_id = ? AND deleted_at IS NULL UNION ALL SELECT 'test_cases', COUNT(*) FROM test_cases WHERE tenant_id = ? AND deleted_at IS NULL UNION ALL SELECT 'workflows', COUNT(*) FROM workflows WHERE tenant_id = ? AND deleted_at IS NULL UNION ALL SELECT 'workflow_runs', COUNT(*) FROM workflow_runs WHERE tenant_id = ?",
        "args": [
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}"
        ]
      }
    },

    "assertDataIsolation": {
      "id": "assertDataIsolation",
      "name": "[Assert] Verify All Data Belongs to Tenant",
      "type": "assert",
      "dependsOn": ["verifyTenantIsolationInDB"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{verifyTenantIsolationInDB.rowCount}}",
            "expected": 5,
            "message": "Should query 5 tables"
          }
        ]
      }
    },

    "getGroupTree": {
      "id": "getGroupTree",
      "name": "[Group] Verify Group Tree Structure",
      "type": "http",
      "dependsOn": ["assertDataIsolation"],
      "config": {
        "method": "GET",
        "url": "{{baseUrl}}/groups/tree",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "timeout": 5000
      }
    },

    "validateTreeStructure": {
      "id": "validateTreeStructure",
      "name": "[Script] Validate Tree Has Parent and Child",
      "type": "script",
      "dependsOn": ["getGroupTree"],
      "config": {
        "language": "python",
        "script": "import json\n\ntree = context.get('getGroupTree', {}).get('response', [])\nparent_id = context.get('generateTimestamp', {}).get('output', {}).get('parent_group_id')\nchild_id = context.get('generateTimestamp', {}).get('output', {}).get('child_group_id')\n\ndef find_group(groups, gid):\n    for g in groups:\n        if g.get('group_id') == gid:\n            return g\n        if 'children' in g:\n            found = find_group(g.get('children', []), gid)\n            if found:\n                return found\n    return None\n\nparent = find_group(tree, parent_id)\nchild = find_group(tree, child_id)\n\nresult = {\n    'parent_found': parent is not None,\n    'child_found': child is not None,\n    'hierarchy_valid': parent is not None and child is not None\n}\n\nprint(json.dumps(result))",
        "timeout": 5
      }
    },

    "assertTreeValid": {
      "id": "assertTreeValid",
      "name": "[Assert] Verify Group Hierarchy",
      "type": "assert",
      "dependsOn": ["validateTreeStructure"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{validateTreeStructure.output.hierarchy_valid}}",
            "expected": true,
            "message": "Group hierarchy should be valid"
          }
        ]
      }
    },

    "createTestEnvironment": {
      "id": "createTestEnvironment",
      "name": "[Env] Create Test Environment",
      "type": "http",
      "dependsOn": ["assertTreeValid"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/environments",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "body": {
          "env_id": "{{generateTimestamp.output.test_env_id}}",
          "name": "Testing",
          "description": "Testing environment",
          "is_active": false,
          "variables": {
            "ENV_NAME": "testing"
          }
        },
        "timeout": 5000
      }
    },

    "switchToTestEnvironment": {
      "id": "switchToTestEnvironment",
      "name": "[Env] Activate Test Environment",
      "type": "http",
      "dependsOn": ["createTestEnvironment"],
      "config": {
        "method": "POST",
        "url": "{{baseUrl}}/environments/{{generateTimestamp.output.test_env_id}}/activate",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "timeout": 5000
      }
    },

    "verifyActiveEnvironment": {
      "id": "verifyActiveEnvironment",
      "name": "[Env] Verify Active Environment Switched",
      "type": "http",
      "dependsOn": ["switchToTestEnvironment"],
      "config": {
        "method": "GET",
        "url": "{{baseUrl}}/environments/active",
        "headers": {
          "Content-Type": "application/json",
          "X-Tenant-ID": "{{generateTimestamp.output.tenant_id}}",
          "X-Project-ID": "{{generateTimestamp.output.project_id}}"
        },
        "timeout": 5000
      }
    },

    "assertEnvironmentSwitched": {
      "id": "assertEnvironmentSwitched",
      "name": "[Assert] Verify Environment Switch",
      "type": "assert",
      "dependsOn": ["verifyActiveEnvironment"],
      "config": {
        "assertions": [
          {
            "type": "equals",
            "actual": "{{verifyActiveEnvironment.status}}",
            "expected": 200,
            "message": "Get active environment should return 200"
          },
          {
            "type": "equals",
            "actual": "{{verifyActiveEnvironment.response.env_id}}",
            "expected": "{{generateTimestamp.output.test_env_id}}",
            "message": "Active environment should be test environment"
          }
        ]
      }
    },

    "cleanupTestData": {
      "id": "cleanupTestData",
      "name": "[Cleanup] Remove All Test Data",
      "type": "database",
      "dependsOn": ["assertEnvironmentSwitched"],
      "config": {
        "driver": "sqlite3",
        "dsn": "{{dbPath}}",
        "queryType": "exec",
        "query": "DELETE FROM workflow_runs WHERE tenant_id = ?; DELETE FROM workflows WHERE tenant_id = ?; DELETE FROM test_results WHERE tenant_id = ?; DELETE FROM test_cases WHERE tenant_id = ?; DELETE FROM test_groups WHERE tenant_id = ?; DELETE FROM environments WHERE tenant_id = ?; DELETE FROM projects WHERE project_id = ?; DELETE FROM tenants WHERE tenant_id = ?",
        "args": [
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.tenant_id}}",
          "{{generateTimestamp.output.project_id}}",
          "{{generateTimestamp.output.tenant_id}}"
        ]
      }
    },

    "generateTestSummary": {
      "id": "generateTestSummary",
      "name": "[Summary] Generate E2E Test Report",
      "type": "script",
      "dependsOn": ["cleanupTestData"],
      "config": {
        "language": "python",
        "script": "import json\nimport datetime\n\nresult = {\n    'test_suite': 'End-to-End Integration Test (Multi-Tenant)',\n    'completed_at': datetime.datetime.now().isoformat(),\n    'scenario': 'Complete platform workflow demonstration',\n    'components_tested': [\n        'Tenant & Project Management',\n        'Environment Management (Create, Switch)',\n        'Test Group Hierarchy',\n        'Test Case Creation & Execution',\n        'Workflow Creation & Execution',\n        'Workflow Step Tracking',\n        'Multi-Tenant Data Isolation'\n    ],\n    'total_api_calls': 18,\n    'database_validations': 2,\n    'workflow_executed': True,\n    'steps_in_workflow': 4,\n    'environments_created': 2,\n    'test_groups_created': 2,\n    'test_cases_executed': 1,\n    'multi_tenant_verified': True,\n    'all_passed': True\n}\n\nprint(json.dumps(result, indent=2))",
        "timeout": 5
      }
    }
  }
}
